#!/usr/bin/python

import numpy as np
from PyQt5 import QtWidgets,QtCore
from PyQt5.QtWidgets import QWidget
from PyQt5.QtGui import QImage
from matplotlib.figure import Figure
from matplotlib.backends.backend_qt4agg import FigureCanvasQTAgg as FigureCanvas


def bind(objectName, propertyName, type):
    _child = self.findChild(QtCore.QObject, objectName)
    def getter(self):
        _pyObject = _child.property(propertyName).toPyObject()
        return type(_pyObject)
    def setter(self, value):
        _child.setProperty(propertyName, QtCore.QVariant(value))    
    return property(getter, setter)



class ProgressDialog(QtWidgets.QProgressDialog):
        def __init__(self,message,min_,max_):
                QtWidgets.QProgressDialog.__init__(self,message,
                                               'Cancel',
                                               min_,
                                               max_)
                self.setWindowModality(QtCore.Qt.WindowModal)
                self.setWindowTitle('Please wait')
                self.setValue(min_)

def saveWithDialog(title,filters,data):
        fname = QtWidgets.QFileDialog.getSaveFileName(None,title,'',filters)
        if fname:
                np.save(str(fname),data)

def numpy_to_qimage8(array,vmin=0,vmax=65535,cmap=None):
        image = np.copy(array)
        
        # Clip:
        image[image<vmin] = vmin
        image[image>vmax] = vmax

        # Scale within clip interval:
        image -= vmin
        if vmax != 0.0:
            image = image*255.0/(vmax-vmin)

        # Convert to 8-bit data:
        image = np.uint8(np.round(image))

        nx,ny = image.shape
      
        qt_image = QImage(image.data,nx,ny,QImage.Format_Indexed8)
        qt_image.ndarray = image
        if cmap != None:
            qt_image.setColorTable(cmap)

        return qt_image


class QMatplotlibCanvas(FigureCanvas):
        def __init__(self):
                self.figure = Figure()
                self.axes = self.figure.add_subplot(111)
                FigureCanvas.__init__(self,self.figure)


class QColortables8:
    RdBu = [4284940319,
             4285137183,
             4285334048,
             4285530912,
             4285727777,
             4285924641,
             4286121506,
             4286318370,
             4286515235,
             4286646307,
             4286843172,
             4287040036,
             4287236901,
             4287433765,
             4287630630,
             4287827494,
             4288024359,
             4288221223,
             4288418087,
             4288614952,
             4288811816,
             4289008681,
             4289205545,
             4289402410,
             4289599274,
             4289796139,
             4289927468,
             4289993773,
             4290125614,
             4290191920,
             4290258225,
             4290390066,
             4290456116,
             4290587957,
             4290654262,
             4290720568,
             4290852409,
             4290918458,
             4291050300,
             4291116605,
             4291182910,
             4291314752,
             4291381057,
             4291512642,
             4291578948,
             4291710789,
             4291777094,
             4291843400,
             4291975241,
             4292041290,
             4292173132,
             4292239437,
             4292305743,
             4292371793,
             4292503635,
             4292569941,
             4292636247,
             4292702297,
             4292768604,
             4292834910,
             4292966496,
             4293032802,
             4293099108,
             4293165158,
             4293231464,
             4293297770,
             4293429612,
             4293495662,
             4293561968,
             4293628274,
             4293694324,
             4293826167,
             4293892473,
             4293958779,
             4294024829,
             4294091135,
             4294157441,
             4294223491,
             4294289542,
             4294290057,
             4294290571,
             4294356878,
             4294357393,
             4294357908,
             4294423958,
             4294424473,
             4294424988,
             4294491038,
             4294491553,
             4294492068,
             4294558375,
             4294558889,
             4294559404,
             4294625455,
             4294625969,
             4294692020,
             4294692535,
             4294693049,
             4294759356,
             4294759871,
             4294760386,
             4294826436,
             4294826951,
             4294827209,
             4294827467,
             4294762189,
             4294762447,
             4294762704,
             4294763218,
             4294697940,
             4294698198,
             4294698456,
             4294698714,
             4294633436,
             4294633694,
             4294633951,
             4294634209,
             4294568931,
             4294569445,
             4294569703,
             4294569961,
             4294570219,
             4294504941,
             4294505199,
             4294505456,
             4294505714,
             4294440436,
             4294440694,
             4294375415,
             4294309623,
             4294178294,
             4294112758,
             4293981430,
             4293915637,
             4293784309,
             4293718773,
             4293587445,
             4293521652,
             4293390580,
             4293324788,
             4293193460,
             4293127667,
             4292996595,
             4292930803,
             4292799474,
             4292733938,
             4292602610,
             4292536818,
             4292405745,
             4292339953,
             4292208625,
             4292142833,
             4292011760,
             4291945968,
             4291814639,
             4291617519,
             4291486190,
             4291289325,
             4291157996,
             4290960876,
             4290829547,
             4290632682,
             4290501354,
             4290304233,
             4290172904,
             4289976040,
             4289844711,
             4289647590,
             4289516261,
             4289319397,
             4289188068,
             4289056483,
             4288859619,
             4288728290,
             4288531425,
             4288399840,
             4288202976,
             4288071647,
             4287874782,
             4287677661,
             4287480540,
             4287283419,
             4287086298,
             4286889177,
             4286692056,
             4286494935,
             4286297814,
             4286100693,
             4285903572,
             4285640915,
             4285443794,
             4285246673,
             4285049808,
             4284852687,
             4284655566,
             4284458445,
             4284261323,
             4284064202,
             4283867081,
             4283604424,
             4283407303,
             4283210182,
             4283013061,
             4282815940,
             4282618819,
             4282552770,
             4282421185,
             4282355392,
             4282289343,
             4282157758,
             4282091710,
             4282025917,
             4281894332,
             4281828283,
             4281762234,
             4281630905,
             4281564856,
             4281498807,
             4281367222,
             4281301429,
             4281235381,
             4281103796,
             4281037747,
             4280971698,
             4280840369,
             4280774320,
             4280708271,
             4280576686,
             4280510893,
             4280444844,
             4280313259,
             4280247208,
             4280181157,
             4280115106,
             4280048799,
             4279982748,
             4279916697,
             4279850646,
             4279784595,
             4279718544,
             4279586957,
             4279520906,
             4279454855,
             4279388548,
             4279322497,
             4279256446,
             4279190395,
             4279124345,
             4279058294,
             4278992243,
             4278860656,
             4278794349,
             4278728298,
             4278662247,
             4278596196,
             4278530145]
    spectral = [4278190080,
                 4278779915,
                 4279435285,
                 4280025120,
                 4280614955,
                 4281270325,
                 4281860160,
                 4282449995,
                 4283105365,
                 4283695200,
                 4284285035,
                 4284940405,
                 4285530240,
                 4285989000,
                 4286120074,
                 4286185611,
                 4286251148,
                 4286382222,
                 4286447759,
                 4286513296,
                 4286644370,
                 4286709907,
                 4286775444,
                 4286906518,
                 4286972055,
                 4287037592,
                 4286775450,
                 4286054555,
                 4285333660,
                 4284678302,
                 4283957407,
                 4283236512,
                 4282581154,
                 4281860259,
                 4281139364,
                 4280484006,
                 4279763111,
                 4279042216,
                 4278386858,
                 4278190253,
                 4278190257,
                 4278190261,
                 4278190265,
                 4278190269,
                 4278190273,
                 4278190277,
                 4278190281,
                 4278190285,
                 4278190289,
                 4278190293,
                 4278190297,
                 4278190301,
                 4278192605,
                 4278195165,
                 4278197469,
                 4278199773,
                 4278202333,
                 4278204637,
                 4278206941,
                 4278209501,
                 4278211805,
                 4278214109,
                 4278216669,
                 4278218973,
                 4278221021,
                 4278221533,
                 4278222301,
                 4278223069,
                 4278223581,
                 4278224349,
                 4278225117,
                 4278225629,
                 4278226397,
                 4278227165,
                 4278227677,
                 4278228445,
                 4278229213,
                 4278229723,
                 4278229975,
                 4278230227,
                 4278230735,
                 4278230987,
                 4278231239,
                 4278231747,
                 4278231999,
                 4278232251,
                 4278232759,
                 4278233011,
                 4278233263,
                 4278233771,
                 4278233768,
                 4278233765,
                 4278233763,
                 4278233760,
                 4278233757,
                 4278233755,
                 4278233752,
                 4278233749,
                 4278233747,
                 4278233744,
                 4278233741,
                 4278233739,
                 4278233736,
                 4278233469,
                 4278232947,
                 4278232680,
                 4278232413,
                 4278231891,
                 4278231624,
                 4278231357,
                 4278230835,
                 4278230568,
                 4278230301,
                 4278229779,
                 4278229512,
                 4278229504,
                 4278230016,
                 4278230784,
                 4278231552,
                 4278232064,
                 4278232832,
                 4278233600,
                 4278234112,
                 4278234880,
                 4278235648,
                 4278236160,
                 4278236928,
                 4278237696,
                 4278238208,
                 4278238976,
                 4278239744,
                 4278240256,
                 4278241024,
                 4278241792,
                 4278242304,
                 4278243072,
                 4278243840,
                 4278244352,
                 4278245120,
                 4278245888,
                 4278246400,
                 4278247168,
                 4278247936,
                 4278248448,
                 4278249216,
                 4278249984,
                 4278250496,
                 4278251264,
                 4278252032,
                 4278252544,
                 4278253312,
                 4278254080,
                 4278254592,
                 4278255360,
                 4279238400,
                 4280155904,
                 4281138944,
                 4282121984,
                 4283039488,
                 4284022528,
                 4285005568,
                 4285923072,
                 4286906112,
                 4287889152,
                 4288806656,
                 4289789696,
                 4290576128,
                 4290837760,
                 4291099648,
                 4291361536,
                 4291623168,
                 4291885056,
                 4292146944,
                 4292408576,
                 4292670464,
                 4292932352,
                 4293193984,
                 4293455872,
                 4293717760,
                 4293913856,
                 4293978624,
                 4294043392,
                 4294173952,
                 4294238720,
                 4294303488,
                 4294434048,
                 4294498816,
                 4294563584,
                 4294694144,
                 4294758912,
                 4294823680,
                 4294954240,
                 4294953216,
                 4294952192,
                 4294951168,
                 4294950144,
                 4294949120,
                 4294948096,
                 4294947072,
                 4294946048,
                 4294945024,
                 4294944000,
                 4294942976,
                 4294941952,
                 4294940928,
                 4294937856,
                 4294934784,
                 4294931712,
                 4294928640,
                 4294925568,
                 4294922496,
                 4294919424,
                 4294916352,
                 4294913280,
                 4294910208,
                 4294907136,
                 4294904064,
                 4294836224,
                 4294705152,
                 4294508544,
                 4294311936,
                 4294180864,
                 4293984256,
                 4293787648,
                 4293656576,
                 4293459968,
                 4293263360,
                 4293132288,
                 4292935680,
                 4292739072,
                 4292608000,
                 4292542464,
                 4292476928,
                 4292345856,
                 4292280320,
                 4292214784,
                 4292083712,
                 4292018176,
                 4291952640,
                 4291821568,
                 4291756032,
                 4291690496,
                 4291559424,
                 4291562508,
                 4291566620,
                 4291570732,
                 4291574844,
                 4291578956,
                 4291583068,
                 4291587180,
                 4291591292,
                 4291595404,
                 4291599516,
                 4291603628,
                 4291607740,
                 4291611852]

    gray = [4278190080,
             4278255873,
             4278321666,
             4278387459,
             4278453252,
             4278519045,
             4278584838,
             4278650631,
             4278716424,
             4278782217,
             4278848010,
             4278913803,
             4278979596,
             4279045389,
             4279111182,
             4279176975,
             4279242768,
             4279308561,
             4279374354,
             4279440147,
             4279505940,
             4279571733,
             4279637526,
             4279703319,
             4279769112,
             4279834905,
             4279900698,
             4279966491,
             4280032284,
             4280098077,
             4280163870,
             4280229663,
             4280295456,
             4280361249,
             4280427042,
             4280492835,
             4280558628,
             4280624421,
             4280690214,
             4280756007,
             4280821800,
             4280887593,
             4280953386,
             4281019179,
             4281084972,
             4281150765,
             4281216558,
             4281282351,
             4281348144,
             4281413937,
             4281479730,
             4281545523,
             4281611316,
             4281677109,
             4281742902,
             4281808695,
             4281874488,
             4281940281,
             4282006074,
             4282071867,
             4282137660,
             4282203453,
             4282269246,
             4282335039,
             4282400832,
             4282466625,
             4282532418,
             4282598211,
             4282664004,
             4282729797,
             4282795590,
             4282861383,
             4282927176,
             4282992969,
             4283058762,
             4283124555,
             4283190348,
             4283256141,
             4283321934,
             4283387727,
             4283453520,
             4283519313,
             4283585106,
             4283650899,
             4283716692,
             4283782485,
             4283848278,
             4283914071,
             4283979864,
             4284045657,
             4284111450,
             4284177243,
             4284243036,
             4284308829,
             4284374622,
             4284440415,
             4284506208,
             4284572001,
             4284637794,
             4284703587,
             4284769380,
             4284835173,
             4284900966,
             4284966759,
             4285032552,
             4285098345,
             4285164138,
             4285229931,
             4285295724,
             4285361517,
             4285427310,
             4285493103,
             4285558896,
             4285624689,
             4285690482,
             4285756275,
             4285822068,
             4285887861,
             4285953654,
             4286019447,
             4286085240,
             4286151033,
             4286216826,
             4286282619,
             4286348412,
             4286414205,
             4286479998,
             4286545791,
             4286611584,
             4286677377,
             4286743170,
             4286808963,
             4286874756,
             4286940549,
             4287006342,
             4287072135,
             4287137928,
             4287203721,
             4287269514,
             4287335307,
             4287401100,
             4287466893,
             4287532686,
             4287598479,
             4287664272,
             4287730065,
             4287795858,
             4287861651,
             4287927444,
             4287993237,
             4288059030,
             4288124823,
             4288190616,
             4288256409,
             4288322202,
             4288387995,
             4288453788,
             4288519581,
             4288585374,
             4288651167,
             4288716960,
             4288782753,
             4288848546,
             4288914339,
             4288980132,
             4289045925,
             4289111718,
             4289177511,
             4289243304,
             4289309097,
             4289374890,
             4289440683,
             4289506476,
             4289572269,
             4289638062,
             4289703855,
             4289769648,
             4289835441,
             4289901234,
             4289967027,
             4290032820,
             4290098613,
             4290164406,
             4290230199,
             4290295992,
             4290361785,
             4290427578,
             4290493371,
             4290559164,
             4290624957,
             4290690750,
             4290756543,
             4290822336,
             4290888129,
             4290953922,
             4291019715,
             4291085508,
             4291151301,
             4291217094,
             4291282887,
             4291348680,
             4291414473,
             4291480266,
             4291546059,
             4291611852,
             4291677645,
             4291743438,
             4291809231,
             4291875024,
             4291940817,
             4292006610,
             4292072403,
             4292138196,
             4292203989,
             4292269782,
             4292335575,
             4292401368,
             4292467161,
             4292532954,
             4292598747,
             4292664540,
             4292730333,
             4292796126,
             4292861919,
             4292927712,
             4292993505,
             4293059298,
             4293125091,
             4293190884,
             4293256677,
             4293322470,
             4293388263,
             4293454056,
             4293519849,
             4293585642,
             4293651435,
             4293717228,
             4293783021,
             4293848814,
             4293914607,
             4293980400,
             4294046193,
             4294111986,
             4294177779,
             4294243572,
             4294309365,
             4294375158,
             4294440951,
             4294506744,
             4294572537,
             4294638330,
             4294704123,
             4294769916,
             4294835709,
             4294901502,
             4294967295]

